package com.att.utils.dw.writer;

import java.io.ByteArrayOutputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.HashMap;
import java.util.Map;

import org.junit.Test;
import org.xml.sax.SAXException;

import com.att.utils.dw.writer.parser.xml.XmlParser;

/**
 * XmlWriterTests tests xml parsing functionality
 * @author aq728y
 *
 */
public class XmlWriterTest {

	private String xml = "<project id=\"BU00006796\" type=\"_Budget\" store=\"MIRISDev\" reportType=\"blocked\" watermark=\"draft\" fileFormat=\"pdf\"><components><component name=\"GENERAL INFORMATION_BLOCKED\" dateModified=\"1394638995891\" type=\"info\" version=\"1\" cols=\"2\" nosave=\"true\" update=\"true\"><rows><row><col format=\"bold\">Principal Investigator</col><col>Glenn Smith</col></row><row><col format=\"bold\">Funding Proposal Title</col><col>Ben Test</col></row><row><col format=\"bold\">Funding Source</col><col>National Institutes of Health</col></row><row><col format=\"bold\">External ID</col><col>tstID</col></row><row><col format=\"bold\">Funding Proposal ID</col><col>FP00003780</col></row><row><col format=\"bold\">Budget ID</col><col>BU00006796</col></row><row><col format=\"bold\">Budget Title</col><col>Ben Test</col></row></rows></component><component name=\"ADMINISTRATIVE PERSONNEL_BLOCKED\" dateModified=\"1394638995891\" type=\"info\" version=\"1\" cols=\"2\" nosave=\"true\" update=\"true\"><rows><row><col format=\"bold\">Accountant</col><col>Tauna Juenger</col></row><row><col format=\"bold\">Administrator</col><col>Jeanne Nevin</col></row><row><col format=\"bold\">Contract Manager</col><col>Lindsey Johnston</col></row><row><col format=\"bold\">Specialist, PreAward</col><col>Maribeth Fair-pingree</col></row><row><col format=\"bold\">Specialist, PostAward</col><col>Sandra Dunnette</col></row><row><col format=\"bold\">Last Modified</col><col>3/12/2014 10:43 AM</col></row></rows></component><component name=\"PERSONNEL_BLOCKED\" dateModified=\"1383585435956\" type=\"data\" version=\"1\" cols=\"6\" nosave=\"true\" update=\"true\"><rows><header><row><col></col><col></col><col format=\"bold\" align=\"right\">Period 1</col><col format=\"bold\" align=\"right\">Period 2</col><col format=\"bold\" align=\"right\">Period 3</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">8/1/2013</col><col format=\"bold\" align=\"right\">8/1/2014</col><col format=\"bold\" align=\"right\">8/1/2015</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">7/31/2014</col><col format=\"bold\" align=\"right\">7/31/2015</col><col format=\"bold\" align=\"right\">7/31/2016</col><col></col></row></header><row><col format=\"bold\">NAME</col><col format=\"bold\">Role</col><col></col><col></col><col></col><col format=\"bold\" align=\"right\">Total Amount</col></row><row><col format=\"bold\" highlighted=\"true\">Smith, Glenn E</col><col>PD/PI</col><col align=\"right\"></col><col align=\"right\"></col><col align=\"right\"></col><col/></row><row><col>Committed %</col><col/><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col/></row><row><col>Committed Person Months</col><col/><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col/></row><row><col>Salary %</col><col/><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col/></row><row><col>Salary Person Months</col><col/><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col/></row><row><col>Adjusted %</col><col/><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col align=\"right\">5.000%</col><col/></row><row><col>Adjusted Person Months</col><col/><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col align=\"right\">0.60</col><col/></row><row><col>Cost Share %</col><col/><col align=\"right\">0.000%</col><col align=\"right\">0.000%</col><col align=\"right\">0.000%</col><col/></row><row><col>Prior Approved %</col><col/><col align=\"right\"></col><col align=\"right\"></col><col align=\"right\"></col><col/></row><row><col format=\"bold\">Total PERSONNEL (salary + fringe benefit)</col><col></col><col align=\"right\">$8,906</col><col align=\"right\">$9,173</col><col align=\"right\">$9,449</col><col align=\"right\">$27,528</col></row></rows></component><component name=\"PATIENT CARE_BLOCKED\" dateModified=\"1376239123896\" type=\"data\" version=\"1\" cols=\"6\" nosave=\"true\" update=\"true\"><rows><header><row><col></col><col></col><col format=\"bold\" align=\"right\">Period 1</col><col format=\"bold\" align=\"right\">Period 2</col><col format=\"bold\" align=\"right\">Period 3</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">8/1/2013</col><col format=\"bold\" align=\"right\">8/1/2014</col><col format=\"bold\" align=\"right\">8/1/2015</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">7/31/2014</col><col format=\"bold\" align=\"right\">7/31/2015</col><col format=\"bold\" align=\"right\">7/31/2016</col><col></col></row></header><row><col format=\"bold\">Procedure Code</col><col><innertable cols=\"2\"><row><col format=\"bold\">CPT Code</col><col format=\"bold\" align=\"center\">Purpose</col></row></innertable></col><col></col><col></col><col></col><col format=\"bold\" align=\"right\">Total Amount</col></row><row><col format=\"bold\" highlighted=\"true\">90002 - Patent foramen ovale, additional defects closed (Arm: PCS1)</col><col><innertable cols=\"2\"><row><col>93799</col><col>Research</col></row></innertable></col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col></row><row><col>Unit Cost</col><col/><col align=\"right\">$641.06</col><col align=\"right\">$660.29</col><col align=\"right\">$680.10</col><col/></row><row><col># of Proc/Patient</col><col/><col align=\"right\">0</col><col align=\"right\">0</col><col align=\"right\">0</col><col/></row><row><col># of Patients</col><col/><col align=\"right\">0</col><col align=\"right\">0</col><col align=\"right\">0</col><col/></row><row><col format=\"bold\" highlighted=\"true\">90002 - Patent foramen ovale, additional defects closed (Arm: PCS 2)</col><col><innertable cols=\"2\"><row><col>93799</col><col>Research</col></row></innertable></col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col></row><row><col>Unit Cost</col><col/><col align=\"right\">$641.06</col><col align=\"right\">$660.29</col><col align=\"right\">$680.10</col><col/></row><row><col># of Proc/Patient</col><col/><col align=\"right\">0</col><col align=\"right\">0</col><col align=\"right\">0</col><col/></row><row><col># of Patients</col><col/><col align=\"right\">0</col><col align=\"right\">0</col><col align=\"right\">0</col><col/></row><row><col format=\"bold\">Total Patient Care</col><col></col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col><col align=\"right\">$0</col></row></rows></component><component name=\"SUPPLIES AND EXTERNAL SERVICES_BLOCKED\" dateModified=\"1374587347726\" type=\"data\" version=\"1\" cols=\"6\" nosave=\"true\" update=\"true\"><rows><header><row><col></col><col></col><col format=\"bold\" align=\"right\">Period 1</col><col format=\"bold\" align=\"right\">Period 2</col><col format=\"bold\" align=\"right\">Period 3</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">8/1/2013</col><col format=\"bold\" align=\"right\">8/1/2014</col><col format=\"bold\" align=\"right\">8/1/2015</col><col></col></row><row><col></col><col></col><col format=\"bold\" align=\"right\">7/31/2014</col><col format=\"bold\" align=\"right\">7/31/2015</col><col format=\"bold\" align=\"right\">7/31/2016</col><col></col></row></header><row><col format=\"bold\">Accounting Category</col><col format=\"bold\">Description</col><col></col><col></col><col></col><col format=\"bold\" align=\"right\">Total Amount</col></row><row><col>Admin Costs</col><col>Admin Costs</col><col align=\"right\">$1,000</col><col align=\"right\">$1,030</col><col align=\"right\">$1,061</col><col align=\"right\">$3,091</col></row><row><col format=\"bold\">Total Supplies</col><col></col><col align=\"right\">$1,000</col><col align=\"right\">$1,030</col><col align=\"right\">$1,061</col><col align=\"right\">$3,091</col></row></rows></component><component name=\"TOTALS_BLOCKED\" dateModified=\"1383585435956\" type=\"totals\" version=\"1\" cols=\"6\" nosave=\"true\" update=\"true\"><rows><row><col format=\"bold\" highlighted=\"true\">Subtotal Direct Cost</col><col></col><col align=\"right\">$9,906</col><col align=\"right\">$10,203</col><col align=\"right\">$10,510</col><col align=\"right\">$30,619</col></row><row><col format=\"bold\" highlighted=\"true\">Total Direct Cost</col><col></col><col align=\"right\">$9,906</col><col align=\"right\">$10,203</col><col align=\"right\">$10,510</col><col align=\"right\">$30,619</col></row><row><col format=\"bold\" highlighted=\"true\">MTDC</col><col></col><col align=\"right\">$9,906</col><col align=\"right\">$10,203</col><col align=\"right\">$10,510</col><col align=\"right\">$30,619</col></row><row><col format=\"bold\" highlighted=\"true\">Indirect Rate</col><col></col><col align=\"right\">57.700%</col><col align=\"right\">57.700%</col><col align=\"right\">57.700%</col><col/></row><row><col format=\"bold\" highlighted=\"true\">Total Indirect Cost</col><col></col><col align=\"right\">$5,716</col><col align=\"right\">$5,887</col><col align=\"right\">$6,064</col><col align=\"right\">$17,667</col></row><row><col format=\"bold\" highlighted=\"true\">TOTAL COST</col><col></col><col align=\"right\">$15,622</col><col align=\"right\">$16,090</col><col align=\"right\">$16,574</col><col align=\"right\">$48,286</col></row></rows></component></components></project>";
	
	@Test
	public void testXmlReport() throws SAXException, IOException {
		Map<String, String> attrs = new HashMap<String, String>();
		attrs.put("landscape", "true");
		attrs.put("secured", "true");
		attrs.put("watermark", "image:src/test/resources/draft.png");
		
		XmlParser parser = new XmlParser(DocType.PDF, attrs);
		parser.parse(xml);
		
		//grab the output file name and create a file from output stream of doc writer
		ByteArrayOutputStream baos = parser.getBaos();
		OutputStream outStream = new FileOutputStream("output/xmlreport.pdf");
		baos.writeTo(outStream);		
	}
}
